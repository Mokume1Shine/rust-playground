# 📄 Rust学習ログ（WSL + VSCode環境）

**日付**: 2025-08-10

## 1. 環境構築と学習テーマ

* WSL(Ubuntu) + VSCode + `rust-analyzer` を利用。
* 学習方針：まずは **Rustらしさを体験できる小さなCLIツール**から。
* 記録用Gitリポジトリ構成を提案（`journal/`, `examples/`, `libs/` など）。

---

## 2. ミニ課題「word-stats」実装

### 仕様

* 標準入力から文章を受け取り：

  1. 改行を除いた文字数
  2. ユニーク単語数（英数字と `_` のみ、大小文字無視）
     を表示する。
* 最初は `HashSet<&str>` に挑戦し、寿命エラーを観察 → 最終的に `HashSet<String>` を使用。

### 実装で学んだこと

* **`count_chars_without_newlines`**

  * 改行除去は `.chars().filter(|&c| c != '\n' && c != '\r')` がシンプル。
  * `.len()` と `.chars().count()` の違い（バイト数 vs Unicodeスカラー値）。
* **`tokenize`**

  * `split_whitespace()` では句読点が残るため、自作ループで英数字＋`_`のみ抽出。
  * `std::mem::take` を使って `String` をコピーせずにリセットする方法を学習。
* **`HashSet<&str>` の挙動**

  * 内容で比較はするが、寿命の制約でスコープ外参照が使えない。
  * 安全に使うなら `HashSet<String>` に所有権ごと格納。
* **`.iter().cloned()` と `.into_iter()` の違い**

  * 後者は所有権を奪うのでコピーなし、前者は要素を複製して残す。

---

## 3. Rust文法・構造に関する理解

* `#[cfg(test)]`

  * 条件付きコンパイルでテスト時だけコードを含める仕組み（Cの `#ifdef` に相当）。
  * 本番コードとテストの分離方法（`tests/` ディレクトリや `lib.rs` 化）も学習。
* `mod`

  * Javaの `class` ではなく、`package` や名前空間に近い存在。
  * クラス的な構造は `struct` + `impl` で表現。
* 関数の戻り値

  * 最後の式が戻り値になる（セミコロンなし）。
  * `if/else` も式なので直接返せる。早期終了は `return` を使う。

---

## 4. 文字列操作の頻出関数（抑えるべき10個）

1. `.len()` / `.chars().count()`
2. `.is_empty()`
3. `.trim()` 系
4. `.split_whitespace()`
5. `.split()` / `.splitn()`
6. `.replace()` / `.replacen()`
7. `.to_lowercase()` / `.to_uppercase()`
8. `.contains()` / `.starts_with()` / `.ends_with()`
9. `char::is_ascii_alphanumeric()` / `.is_alphanumeric()`
10. `.collect::<String>()`

---

## 5. 性能比較実験

* **テーマ**: `split_whitespace()` vs `split(' ')`
* 簡易ベンチマーク（`--release` 有無で計測）を実施。
* **結果**: 今回の入力では `split(' ')` の方が速いケースが多かった。

  * 理由：`split_whitespace()` はUnicode空白全対応＋連続空白スキップ処理が重い。
  * ただし要件次第で正しさが変わるため、用途で使い分けるべき。

---

## 6. 今日の質問リスト

1. `usize` が戻り値に使われる理由は？（配列長さ型と統一・符号不要）
2. `Vec` に `.count()` はないの？（代わりに `.len()`）
3. `HashSet<&str>` で大文字小文字違いが別物扱いになる理由と回避法
4. `std::mem::take` と `&mut` の関係
5. `#[cfg(test)]` の意味と `cfg` の正体
6. `mod` はJavaでいう何か？（packageに近い）
7. 文字列操作で抑えておくべき関数
8. `split_whitespace()` と `split()` の性能比較
9. Rustでの戻り値の書き方と分岐時の書き方

---

## 7. 次の一歩（提案）

* 現在の `word-stats` に **頻出語TOP N** 機能を追加（`HashMap<String, usize>`で集計）。
* あるいは `clap` クレートで `--json` オプション追加し、JSON形式出力に対応。
* `lib.rs` 化してテストコードを `tests/` に移し、`#[cfg(test)]` を本番コードから排除。
